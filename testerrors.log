FAIL src/tests/api/health.test.ts
  ‚óè Test suite failed to run
    src/lib/bitcoin-price-service.ts:581:9 - error TS2353: Object literal may only specify known properties, and 'coldWalletBTC' does not exist in type 'Omit<PortfolioSummaryData, "lastUpdated" | "portfolioChange24hPercent" | "lastPriceUpdate" | "portfolioChange24hUSD" | "portfolioChange24hMain" | "portfolioChange24hPercentage" | "portfolioChange24hSecondary">'.
    581         coldWalletBTC,
                ~~~~~~~~~~~~~
    src/lib/bitcoin-price-service.ts:623:9 - error TS2353: Object literal may only specify known properties, and 'coldWalletBTC' does not exist in type 'Omit<PortfolioSummaryData, "lastUpdated" | "portfolioChange24hPercent" | "lastPriceUpdate" | "portfolioChange24hUSD" | "portfolioChange24hMain" | "portfolioChange24hPercentage" | "portfolioChange24hSecondary">'.
    623         coldWalletBTC: 0,
                ~~~~~~~~~~~~~
PASS src/tests/setup.test.ts


Error: ERROR] Error fetching today's OHLC data: Error: Price service error
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:333:65
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:37:23)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:18:53)
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:12:71
          at new Promise (<anonymous>)
          at Object.<anonymous>.__awaiter (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:8:12)
          at Object.<anonymous> (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:322:64)
          at Promise.then.completed (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at run (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:444:34)
      19 |     
      20 |   } catch (error) {
    > 21 |     console.error('[ERROR] Error fetching today\'s OHLC data:', error);
         |             ^
      22 |     
      23 |     return NextResponse.json({
      24 |       success: false,
      at error (src/app/api/bitcoin-price/today/route.ts:21:13)
      at step (src/app/api/bitcoin-price/today/route.ts:3026:19)
      at Object.throw (src/app/api/bitcoin-price/today/route.ts:2792:14)
      at rejected (src/app/api/bitcoin-price/today/route.ts:2701:32)
    console.log

    Error: ERROR] Error fetching today's OHLC data: Error: Database error
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:310:63
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:37:23)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:18:53)
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:12:71
          at new Promise (<anonymous>)
          at Object.<anonymous>.__awaiter (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:8:12)
          at Object.<anonymous> (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:309:40)
          at Promise.then.completed (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at run (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:444:34)
      19 |     
      20 |   } catch (error) {
    > 21 |     console.error('[ERROR] Error fetching today\'s OHLC data:', error);
         |             ^
      22 |     
      23 |     return NextResponse.json({
      24 |       success: false,
      at error (src/app/api/bitcoin-price/today/route.ts:21:13)
      at step (src/app/api/bitcoin-price/today/route.ts:3026:19)
      at Object.throw (src/app/api/bitcoin-price/today/route.ts:2792:14)
      at rejected (src/app/api/bitcoin-price/today/route.ts:2701:32)
    console.log
      üßπ Test database cleaned
      at log (src/tests/test-db.ts:245:13)

      onsole.log
      üßπ Test database cleaned
      at log (src/tests/test-db.ts:245:13)
    console.log
      üå± Test database seeded
      at log (src/tests/test-db.ts:356:13)
    console.error
      Error fetching Bitcoin price: Error: Service unavailable
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:157:65
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:37:23)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:18:53)
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:12:71
          at new Promise (<anonymous>)
          at Object.<anonymous>.__awaiter (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:8:12)
          at Object.<anonymous> (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:156:57)
          at Promise.then.completed (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at run (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:444:34)
      28 |     });
      29 |   } catch (error) {
      Error updating portfolio after price refresh: Error: Portfolio error
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:238:83
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:37:23)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:18:53)
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:12:71
          at new Promise (<anonymous>)
          at Object.<anonymous>.__awaiter (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:8:12)
          at Object.<anonymous> (/home/runner/work/BTC-Tracker/BTC-Tracker/src/tests/api/bitcoin-price.test.ts:227:72)
          at Promise.then.completed (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at run (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:444:34)
      64 |       await BitcoinPriceService.calculateAndStorePortfolioSummary(priceData.price);
      65 |     } catch (portfolioError) {
    > 66 |       console.error('Error updating portfolio after price refresh:', portfolioError);
         |               ^
      67 |       portfolioUpdateMessage = 'but portfolio update failed';
      68 |     }
      69 |     
      at error (src/app/api/bitcoin-price/route.ts:66:15)
      at step (src/app/api/bitcoin-price/route.ts:3562:19)


      üßπ Test database cleaned
      at log (src/tests/test-db.ts:245:13)
    console.log
      üå± Test database seeded
      at log (src/tests/test-db.ts:356:13)
    console.error
      Error updating settings: Error: Invalid main currency: INVALID_XYZ. Main currency must be one of: USD, EUR, PLN, GBP, CAD, AUD, JPY, CHF, SEK, NOK
          at Function.SettingsService.validateCurrencySettings (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:14:13)
          at Function.validateCurrencySettings (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:204:10)
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:6424:19)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:6190:14)
          at /home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:6122:39
          at new Promise (<anonymous>)
          at Object.<anonymous>.__awaiter (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:6071:10)
          at Function.SettingsService.updateCurrencySettings (/home/runner/work/BTC-Tracker/BTC-Tracker/src/lib/settings-service.ts:7061:12)
          at updateCurrencySettings (/home/runner/work/BTC-Tracker/BTC-Tracker/src/app/api/settings/route.ts:68:51)
          at step (/home/runner/work/BTC-Tracker/BTC-Tracker/src/app/api/settings/route.ts:4845:19)
          at Object.next (/home/runner/work/BTC-Tracker/BTC-Tracker/src/app/api/settings/route.ts:4611:14)
          at fulfilled (/home/runner/work/BTC-Tracker/BTC-Tracker/src/app/api/settings/route.ts:4506:24)
      102 |
      103 |   } catch (error) {
    > 104 |     console.error('Error updating settings:', error);
          |             ^
      105 |     
      106 |     // Handle validation errors specifically
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:121:9)
          at run (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/home/runner/work/BTC-Tracker/BTC-Tracker/node_modules/jest-runner/build/runTest.js:444:34)
      152 |
      153 |   } catch (error) {
    > 154 |     console.error('Error replacing settings:', error);
          |             ^
      155 |     
      156 |     // Handle validation errors specifically
      157 |     if (error instanceof Error && error.message.includes('Invalid main currency')) {
      at error (src/app/api/settings/route.ts:154:13)
      at step (src/app/api/settings/route.ts:4845:19)
      at Object.throw (src/app/api/settings/route.ts:4611:14)
      at rejected (src/app/api/settings/route.ts:4520:32)
    console.log